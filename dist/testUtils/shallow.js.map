{"version":3,"file":"shallow.js","names":["React","ShallowRenderer","isFragment","isLazy","isPortal","isMemo","isSuspense","isForwardRef","ElementExplorer","getNodeName","node","displayName","name","ReactShallowRenderer","constructor","children","Wrapper","arguments","length","undefined","_defineProperty","shallowRenderer","shallowWrapper","render","createElement","shallow","Component","out","error","message","includes","console","log","flatRender","child","loadEl","toLoad","_toLoad$props","props","_objectWithoutProperties","_excluded","el","type","Array","isArray","map","isEmptyRender","data","getRenderOutput","snapshot","instance","toSnapshot","extractType","getWrappedName","outerNode","innerNode","wrapperName","functionName","transformNode","extractProps","_ref","key","_excluded2","childrenArray","filter","Boolean","flatMap","_objectSpread","n","$$typeof","Symbol","for"],"sources":["../../src/testUtils/shallow.jsx"],"sourcesContent":["/* eslint-disable import/no-extraneous-dependencies */\nimport React from 'react';\nimport ShallowRenderer from 'react-test-renderer/shallow';\nimport {\n  isFragment,\n  isLazy,\n  isPortal,\n  isMemo,\n  isSuspense,\n  isForwardRef,\n} from 'react-is';\nimport ElementExplorer from './ElementExplorer';\n\nconst getNodeName = node => node.displayName || node.name || '';\n\nclass ReactShallowRenderer {\n  shallowRenderer = null;\n\n  constructor(children, { Wrapper = null } = {}) {\n    this.shallowRenderer = new ShallowRenderer();\n    this.shallowWrapper = Wrapper\n      ? this.shallowRenderer.render(<Wrapper>{children}</Wrapper>)\n      : this.shallowRenderer.render(children);\n  }\n\n  static shallow(Component) {\n    let out;\n    try {\n      out = new ReactShallowRenderer(Component);\n    } catch (error) {\n      if (!error.message.includes('ReactShallowRenderer')) {\n        console.log({ error, out });\n      }\n      out = ReactShallowRenderer.flatRender(Component);\n    }\n    return out;\n  }\n\n  static flatRender(child) {\n    const loadEl = (toLoad) => {\n      if (typeof toLoad === 'object') {\n        const { children, ...props } = toLoad.props;\n        const el = { type: toLoad.type, props };\n        if (Array.isArray(children)) {\n          el.children = children.map(loadEl);\n        } else if (children !== undefined) {\n          el.children = [loadEl(children)];\n        } else {\n          el.children = [];\n        }\n        return el;\n      }\n      // custom return for basic jsx components (mostly for shallow comparison)\n      return {\n        el: toLoad,\n        type: null,\n        props: {},\n        children: [],\n      };\n    };\n    return loadEl(child);\n  }\n\n  isEmptyRender() {\n    const data = this.getRenderOutput();\n    return data === null || data === false;\n  }\n\n  get snapshot() {\n    return this.getRenderOutput(true);\n  }\n\n  get instance() {\n    return new ElementExplorer(this.getRenderOutput(), ReactShallowRenderer.toSnapshot);\n  }\n\n  extractType(node) {\n    if (typeof node === 'string') { return node; }\n\n    const name = getNodeName(node.type) || node.type || 'Component';\n\n    if (isLazy(node)) { return 'Lazy'; }\n\n    if (isMemo(node)) { return `Memo(${name || this.extractType(node.type)})`; }\n\n    if (isSuspense(node)) { return 'Suspense'; }\n\n    if (isPortal(node)) { return 'Portal'; }\n\n    if (isFragment(node)) { return 'Fragment'; }\n\n    if (isForwardRef(node)) { return this.getWrappedName(node, node.type.render, 'ForwardRef'); }\n\n    return name;\n  }\n\n  getWrappedName(outerNode, innerNode, wrapperName) {\n    const functionName = getNodeName(innerNode);\n    return outerNode.type.displayName || (functionName !== '' ? `${wrapperName}(${functionName})` : wrapperName);\n  }\n\n  getRenderOutput(render = false) {\n    if (!this.shallowWrapper) {\n      return this.shallowWrapper;\n    }\n    return this.transformNode(this.shallowWrapper, render);\n  }\n\n  // eslint-disable-next-line\n  extractProps({ children, ...props } = {}, key, render) {\n    const childrenArray = Array.isArray(children) ? children : [children];\n    return {\n      children: childrenArray.filter(Boolean).flatMap(\n        (node) => this.transformNode(node, render),\n      ),\n      props: {\n        ...props,\n        ...(key ? { key } : {}),\n      },\n    };\n  }\n\n  transformNode(node, render) {\n    if (Array.isArray(node)) {\n      return node.map((n) => this.transformNode(n, render));\n    }\n    if (typeof node !== 'object') {\n      return node;\n    }\n    const out = {\n      type: this.extractType(node),\n      ...this.extractProps(node.props, node.key, render),\n    };\n    if (render) {\n      // this symbol is used by Jest to prettify serialized React test objects:\n      // https://github.com/facebook/jest/blob/e0b33b74b5afd738edc183858b5c34053cfc26dd/packages/pretty-format/src/plugins/ReactTestComponent.ts\n      out.$$typeof = Symbol.for('react.test.json');\n    }\n    return out;\n  }\n\n  static toSnapshot(data) {\n    return {\n      ...data,\n      $$typeof: Symbol.for('react.test.json'),\n      children: data.children.map(ReactShallowRenderer.toSnapshot),\n    };\n  }\n}\n\nexport default ReactShallowRenderer.shallow;\n"],"mappings":"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","ignoreList":[]}